{% extends "layout.html" %}
{% block content %}

<div class="container mt-4">

    <!-- TÃ­tulo del taller -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>ğŸ”§ ReseÃ±as de <b>{{ taller.nombre_usu }}</b></h2>
        <a href="{{ url_for('routes.comentarios_listado') }}" class="btn btn-secondary btn-sm">â¬… Volver</a>
    </div>

    <!-- ğŸ”¹ Formulario de comentario (solo clientes) -->
    {% if session.get('usuario') and session['usuario']['rol'] == 'cliente' %}
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">âœï¸ Deja tu reseÃ±a</h5>
            <form method="POST">
                <div class="mb-3">
                    <label for="comentario" class="form-label">Tu comentario</label>
                    <textarea name="comentario" id="comentario" class="form-control" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="calificacion" class="form-label">CalificaciÃ³n</label>
                    <select name="calificacion" id="calificacion" class="form-select" required>
                        <option value="5">â­â­â­â­â­ (5)</option>
                        <option value="4">â­â­â­â­ (4)</option>
                        <option value="3">â­â­â­ (3)</option>
                        <option value="2">â­â­ (2)</option>
                        <option value="1">â­ (1)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Publicar comentario</button>
            </form>
        </div>
    </div>
    {% else %}
    <!-- ğŸ”¹ Mensaje si NO es cliente -->
    <div class="alert alert-info text-center mb-4">
        ğŸ”’ Debes <a href="{{ url_for('routes.login') }}">iniciar sesiÃ³n</a> como <b>cliente</b> para dejar un comentario.
    </div>
    {% endif %}

    <!-- ğŸ”¹ Listado de comentarios -->
    <h4 class="mb-3">ğŸ’¬ Opiniones de clientes</h4>
    {% if comentarios %}
    <div class="list-group">
        {% for c in comentarios %}
        <div class="list-group-item list-group-item-action mb-2 shadow-sm rounded">
            <p class="mb-1">"{{ c.comentario }}"</p>
            <small class="text-muted">
                ğŸ‘¤ <b>{{ c.cliente_nombre }}</b> |
                â­ {{ c.calificacion }}/5 |
                ğŸ“… {{ c.fecha.strftime("%d/%m/%Y %H:%M:%S") if c.fecha else "" }}
            </small>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p class="text-muted">âŒ AÃºn no hay comentarios para este taller.</p>
    {% endif %}
</div>

{% endblock %}
